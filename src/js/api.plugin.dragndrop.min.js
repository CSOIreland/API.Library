var api=api||{};api.plugin=api.plugin||{},api.plugin.dragndrop={},api.plugin.dragndrop.readFiles=function(e,t){e=e||null,t=t||null},api.plugin.dragndrop.initiate=function(e,t){var r,a=("draggable"in(r=e.createElement("div"))||"ondragstart"in r&&"ondrop"in r)&&"FormData"in t&&"FileReader"in t,n=e.querySelectorAll(".box");Array.prototype.forEach.call(n,(function(t){var r=t.querySelector('input[type="file"]'),n=(t.querySelector("label"),t.querySelector(".box__error span")),i=t.querySelectorAll(".box__restart"),s=!1,o=e.createElement("input");o.setAttribute("type","hidden"),o.setAttribute("name","ajax"),o.setAttribute("value",1),t.appendChild(o),r.addEventListener("change",(function(e){s=e.target.files,api.plugin.dragndrop.readFiles(s,$(this))})),a&&(t.classList.add("has-advanced-upload"),["drag","dragstart","dragend","dragover","dragenter","dragleave","drop"].forEach((function(e){t.addEventListener(e,(function(e){e.preventDefault(),e.stopPropagation()}))})),["dragover","dragenter"].forEach((function(e){t.addEventListener(e,(function(){t.classList.add("is-dragover")}))})),["dragleave","dragend","drop"].forEach((function(e){t.addEventListener(e,(function(){t.classList.remove("is-dragover")}))})),t.addEventListener("drop",(function(e){s=e.dataTransfer.files,api.plugin.dragndrop.readFiles(s,$(this).find('input[type="file"]'))}))),t.addEventListener("submit",(function(i){if(t.classList.contains("is-uploading"))return!1;if(t.classList.add("is-uploading"),t.classList.remove("is-error"),a){i.preventDefault();var o=new FormData(t);s&&Array.prototype.forEach.call(s,(function(e){o.append(r.getAttribute("name"),e)}));var d=new XMLHttpRequest;d.open(t.getAttribute("method"),t.getAttribute("action"),!0),d.onload=function(){if(t.classList.remove("is-uploading"),d.status>=200&&d.status<400){var e=JSON.parse(d.responseText);t.classList.add(1==e.success?"is-success":"is-error"),e.success||(n.textContent=e.error)}else alert("Error. Please, contact the webmaster!")},d.onerror=function(){t.classList.remove("is-uploading"),alert("Error. Please, try again!")},d.send(o)}else{var l="uploadiframe"+(new Date).getTime(),c=e.createElement("iframe");$iframe=$('<iframe name="'+l+'" style="display: none;"></iframe>'),c.setAttribute("name",l),c.style.display="none",e.body.appendChild(c),t.setAttribute("target",l),c.addEventListener("load",(function(){var e=JSON.parse(c.contentDocument.body.innerHTML);t.classList.remove("is-uploading"),t.classList.add(1==e.success?"is-success":"is-error"),t.removeAttribute("target"),e.success||(n.textContent=e.error),c.parentNode.removeChild(c)}))}})),Array.prototype.forEach.call(i,(function(e){e.addEventListener("click",(function(e){e.preventDefault(),t.classList.remove("is-error","is-success"),r.click()}))})),r.addEventListener("focus",(function(){r.classList.add("has-focus")})),r.addEventListener("blur",(function(){r.classList.remove("has-focus")}))}))};