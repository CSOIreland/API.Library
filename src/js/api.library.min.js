var api=api||{};api.spinner={};api.spinner.count=0;api.spinner.progress={};api.spinner.progress.instance=null;api.spinner.progress.timeout=0;api.spinner.start=function(pItemSpinner=null){if(pItemSpinner!=null){$(pItemSpinner).find(".item-spinner").remove();var item=$("#spinner-holder").find(".item-spinner").clone();$(pItemSpinner).prepend($(item));$(item).removeClass("d-none");$(pItemSpinner).find(".item-spinner").show();let resizeObserver=new ResizeObserver((()=>{$(pItemSpinner).find(item).find(".item-loader").css("margin-top",$(pItemSpinner).height()*.5-15)}));resizeObserver.observe($(pItemSpinner)[0])}else if(!api.spinner.count++){$("#spinner").show()}};api.spinner.stop=function(pItemSpinner=null){if(pItemSpinner!=null){$(pItemSpinner).find(".item-spinner").find(".item-loader").addClass("d-none");$(pItemSpinner).find(".item-spinner").remove()}else{if(api.spinner.count){api.spinner.count--}if(!api.spinner.count){if(api.spinner.progress.instance){api.spinner.progress.stop();setTimeout((function(){$("#spinner").fadeOut("slow")}),1e3)}else{$("#spinner").fadeOut("slow")}}}};api.spinner.progress.start=function(progressTimeout){if(progressTimeout){clearTimeout(api.spinner.progress.instance);api.spinner.progress.timeout=progressTimeout;$("#spinner .progress").find("[name=bar]").css("width","1%").attr("aria-valuenow",1);$("#spinner .progress").find("[name=percentage]").text("1%");$("#spinner .progress").show();api.spinner.progress.setTimeout()}};api.spinner.progress.stop=function(){clearTimeout(api.spinner.progress.instance);$("#spinner .progress").find("[name=bar]").css("width","100%").attr("aria-valuenow",100);$("#spinner .progress").find("[name=percentage]").text("100%");$("#spinner .progress").fadeOut("slow")};api.spinner.progress.getTimeout=function(unitsToProcess,unitsPerSecond){var timeout=unitsToProcess/unitsPerSecond;timeout=timeout/100*1*1e3;return timeout};api.spinner.progress.setTimeout=function(){api.spinner.progress.timeout=Math.ceil(api.spinner.progress.timeout+api.spinner.progress.timeout/100*.5);api.spinner.progress.instance=setTimeout((function(){var percentage=Math.min(parseInt($("#spinner .progress").find("[name=bar]").attr("aria-valuenow"))+1,99);$("#spinner .progress").find("[name=bar]").css("width",percentage+"%").attr("aria-valuenow",percentage);$("#spinner .progress").find("[name=percentage]").text(percentage+"%");api.spinner.progress.setTimeout()}),api.spinner.progress.timeout)};api.content={};api.content.params={};api.content.getParam=function(pKey){return api.content.params[pKey]};api.content.load=function(pSelectorContainer,pRelativeURL,pParams,pAppend){api.spinner.start();pParams=pParams||{};pAppend=pAppend||false;var uri=new URI(pRelativeURL);if(uri.is("relative")===false)return;$.ajax({url:pRelativeURL,async:false,success:function(response){api.content.params=pParams;if(pAppend)$(pSelectorContainer).append(response).promise().done((function(){api.content.params={};api.spinner.stop()}));else $(pSelectorContainer).empty().html(response).promise().done((function(){api.content.params={};api.spinner.stop()}))}})};api.content.navigate=function(pNavSelector,pRelativeURL,pNav_link_SelectorToHighlight,pNav_menu_SelectorToHighlight){pNav_link_SelectorToHighlight=pNav_link_SelectorToHighlight||null;pNav_menu_SelectorToHighlight=pNav_menu_SelectorToHighlight||null;var uri=new URI(pRelativeURL);if(uri.is("relative")===false)return;$(pNavSelector).click((function(e){e.preventDefault();$.ajax({url:pRelativeURL,async:false,success:function(response){$("#body").hide().empty().html(response).fadeIn()}});$("#navigation").find("*").removeClass("show");$("#navigation").find("*").removeClass("active");if(pNav_link_SelectorToHighlight)$(pNav_link_SelectorToHighlight).addClass("active");if(pNav_menu_SelectorToHighlight){$(pNav_menu_SelectorToHighlight).addClass("active")}}))};api.content.goTo=function(pRelativeURL,pNav_link_SelectorToHighlight,pNav_menu_SelectorToHighlight,pParams){api.spinner.start();pNav_link_SelectorToHighlight=pNav_link_SelectorToHighlight||null;pNav_menu_SelectorToHighlight=pNav_menu_SelectorToHighlight||null;pParams=pParams||{};var uri=new URI(pRelativeURL);if(uri.is("relative")===false)return;$.ajax({url:pRelativeURL,async:false,success:function(response){api.content.params=pParams;$("#body").hide().empty().html(response).fadeIn().promise().done((function(){api.content.params={};api.spinner.stop()}))}});$("#navigation").find("*").removeClass("show");$("#navigation").find("*").removeClass("active");if(pNav_link_SelectorToHighlight)$(pNav_link_SelectorToHighlight).addClass("active");if(pNav_menu_SelectorToHighlight){$(pNav_menu_SelectorToHighlight).addClass("active")}};api.ajax={};api.ajax.callback=function(pFunction,pResponse,pParams){pResponse=pResponse||null;pParams=pParams||{};var context=window;var callbackFunction="";callbackFunction=context[pFunction];if(typeof callbackFunction==="function"){if(jQuery.isEmptyObject(pParams))return callbackFunction(pResponse);else return callbackFunction(pResponse,pParams)}var namespaces=pFunction.split(".");var functionName=namespaces.pop();for(var i=0;i<namespaces.length;i++){context=context[namespaces[i]]}if(context){callbackFunction=context[functionName];if(jQuery.isEmptyObject(pParams))return callbackFunction(pResponse);else return callbackFunction(pResponse,pParams)}return false};api.ajax.config=function(pUrl,pCallback,pAjaxParams){pAjaxParams=pAjaxParams||{};pAjaxParams.method=pAjaxParams.method||"GET";pAjaxParams.dataType=pAjaxParams.dataType||"json";pAjaxParams.jsonp=pAjaxParams.jsonp||false;pAjaxParams.timeout=pAjaxParams.timeout||6e4;pAjaxParams.async=pAjaxParams.async||false;ajaxParams={url:pUrl,success:function(response){pCallback(response)},error:function(jqXHR,textStatus,errorThrown){console.log('An Internal Server has occurred: the configuration file "'+pUrl+'" is missing or invalid.')}};$.extend(ajaxParams,pAjaxParams);$.ajax(ajaxParams)};api.ajax.jsonrpc={};api.ajax.jsonrpc.request=function(pAPI_URL,pAPI_Method,pAPI_Params,callbackFunctionName_onSuccess,callbackParams_onSuccess,callbackFunctionName_onError,callbackParams_onError,pAJAX_Params,pItemSpinner=null){pAPI_Params=pAPI_Params||{};callbackFunctionName_onSuccess=callbackFunctionName_onSuccess||null;callbackFunctionName_onError=callbackFunctionName_onError||null;callbackParams_onSuccess=callbackParams_onSuccess||null;callbackParams_onError=callbackParams_onError||null;pAJAX_Params=pAJAX_Params||{};pAJAX_Params.method=pAJAX_Params.method||"POST";pAJAX_Params.dataType=pAJAX_Params.dataType||"json";pAJAX_Params.jsonp=pAJAX_Params.jsonp||false;pAJAX_Params.timeout=pAJAX_Params.timeout||18e4;var simulateSync=pAJAX_Params.async===undefined?false:!pAJAX_Params.async;pAJAX_Params.async=true;var callID=Math.floor(Math.random()*999999999)+1;var data4Ajax={jsonrpc:"2.0",method:pAPI_Method,params:pAPI_Params,id:callID};var extendedAJAXParams={url:pAPI_URL,data:JSON.stringify(data4Ajax),xhrFields:{withCredentials:true},success:function(response){if(pAJAX_Params.dataType=="json"&&response.id!=callID){api.modal.exception("An invalid JSON-RPC Identifier has been detected. Please try again.");return}if(response.error){var errorOutput=null;if(response.error.data){if($.isArray(response.error.data)&&response.error.data.length||$.isPlainObject(response.error.data)&&!$.isEmptyObject(response.error.data)){errorOutput=$("<ul>",{class:"list-group"});$.each(response.error.data,(function(_index,value){var error=$("<li>",{class:"list-group-item",html:value.toString()});errorOutput.append(error)}))}else errorOutput=response.error.data}else{errorOutput=response.error.message}api.modal.error(errorOutput);if(callbackFunctionName_onError){api.ajax.callback(callbackFunctionName_onError,response.error,callbackParams_onError)}}else if(response.result!==undefined){if(callbackFunctionName_onSuccess)api.ajax.callback(callbackFunctionName_onSuccess,response.result,callbackParams_onSuccess)}else api.modal.exception("An unexpected error has occurred. Please try again.")},error:function(jqXHR,textStatus,errorThrown){if(callbackFunctionName_onError){api.ajax.callback(callbackFunctionName_onError,null,callbackParams_onError)}else if(errorThrown=="Unauthorized"){}else{api.modal.exception("A Server or Network Error has occurred. Please try again.")}},complete:function(){if(simulateSync)api.spinner.stop(pItemSpinner);$("#nav-loader").removeClass("text-yellow fa-spin").addClass("text-navbar");$("body").css("cursor","default")}};$.extend(extendedAJAXParams,pAJAX_Params);try{$("#nav-loader").removeClass("text-navbar").addClass("text-yellow fa-spin");$("body").css("cursor","progress");if(simulateSync)api.spinner.start(pItemSpinner);api.cookie.session.extend();return $.ajax(extendedAJAXParams)}catch(error){console.log(error);api.modal.exception("An unhandled Ajax exception has occurred. Please try again.");return false}};api.modal={};api.modal.confirm=function(pMessage,pCallbackMethod,pCallbackParams){$("#modal-confirm").find(".modal-body > p").empty().html(pMessage);$("#modal-confirm").find("[name=confirm]").once("click",(function(){$("#modal-confirm").modal("hide").delay(100).queue((function(){pCallbackMethod(pCallbackParams);$(this).dequeue()}))}));$("#modal-confirm").modal()};api.modal.success=function(pMessage){$("#modal-success").find(".modal-body > p").empty().html(pMessage);$("#modal-success").modal()};api.modal.error=function(pMessage){$("#modal-error").find(".modal-body > p").empty().html(pMessage);$("#modal-error").modal()};api.modal.information=function(pMessage){$("#modal-information").find(".modal-body > p").empty().html(pMessage);$("#modal-information").modal()};api.modal.exception=function(pMessage){$("#modal-exception").find(".modal-body > p").empty().html(pMessage);$("#modal-exception").modal()};api.uri={};api.uri.parse=function(pURL){var URI=new URI(pURL);return URI.parseQuery(uri.search())};api.uri.isParam=function(pParam,pURL){pURL=pURL||window.location.href;var uri=new URI(pURL);var paramsURL=URI.parseQuery(uri.search());if(pParam in paramsURL)return true;else return false};api.uri.getParam=function(pParam,pURL){pURL=pURL||window.location.href;var uri=new URI(pURL);var paramsURL=URI.parseQuery(uri.search());if(pParam in paramsURL)return paramsURL[pParam];else return false};api.uri.getNoHeader=function(){return api.uri.isParam(C_API_URI_NOHEADER)};api.uri.getNoNavbar=function(){return api.uri.isParam(C_API_URI_NONAVBAR)};api.uri.getNoFooter=function(){return api.uri.isParam(C_API_URI_NOFOOTER)};api.uri.getBody=function(){return api.uri.getParam(C_API_URI_BODY)};api.cookie={};api.cookie.session={};api.cookie.session.data={length:null,expiry:null,logoutEndpoint:null,logoutMethod:null};api.cookie.session.options={path:"/",secure:"true",sameSite:"strict"};api.cookie.session.confirmExtension=function(){};api.cookie.session.start=function(pLength,pLogoutEnpoint,pLogoutMethod){var timestamp=Math.round((new Date).getTime()/1e3);Cookies.set(C_API_COOKIE_SESSION,$.extend(true,{},api.cookie.session.data,{length:pLength,expiry:timestamp+pLength,logoutEndpoint:pLogoutEnpoint,logoutMethod:pLogoutMethod}),api.cookie.session.options);window.setInterval(api.cookie.session.intervalRoutine,1e3)};api.cookie.session.extend=function(){var data=Cookies.getJSON(C_API_COOKIE_SESSION);if(data){var timestamp=Math.round((new Date).getTime()/1e3);Cookies.set(C_API_COOKIE_SESSION,$.extend(true,{},data,{length:data.length,expiry:timestamp+data.length}),api.cookie.session.options)}};api.cookie.session.end=function(logoutEndpoint,logoutMethod){logoutEndpoint=logoutEndpoint||null;logoutMethod=logoutMethod||null;var session=Cookies.getJSON(C_API_COOKIE_SESSION);api.ajax.jsonrpc.request(logoutEndpoint||session.logoutEndpoint,logoutMethod||session.logoutMethod,null,"api.cookie.session.endCallbak");Cookies.remove(C_API_COOKIE_SESSION)};api.cookie.session.endCallbak=function(data){if(data==C_API_AJAX_SUCCESS){window.location.href=window.location.pathname}else{api.modal.exception("An unexpected error has occurred. Please try again.")}};api.cookie.session.intervalRoutine=function(){var data=Cookies.getJSON(C_API_COOKIE_SESSION);if(!data||$.active){return}var timestamp=Math.round((new Date).getTime()/1e3);if(timestamp>data.expiry){api.cookie.session.end()}else if(timestamp>data.expiry-60){api.cookie.session.confirmExtension()}else{}};
